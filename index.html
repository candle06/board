<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eleview Chat</title>

<style>
:root {
  --bg:#050314;--card:#141226;--accent:#b184ff;
  --accent-soft:rgba(177,132,255,0.3);
  --text-main:#fff;--text-sub:#b8b8d9;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;
  background:radial-gradient(circle at top,#261654 0,#050314 55%,#02010a 100%);
  color:var(--text-main);display:flex;justify-content:center;min-height:100vh;
}
.app{width:100%;max-width:480px;padding:18px 16px 32px;}
header{text-align:center;margin-bottom:18px;position:relative;}
.logo{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 12px;border-radius:999px;
  background:rgba(9,9,40,0.6);
  border:1px solid rgba(177,132,255,0.4);
  font-size:13px;color:var(--accent);
}
.title{margin-top:12px;font-size:22px;font-weight:700;}
.subtitle{margin-top:4px;font-size:13px;color:var(--text-sub);}
.status-chip{
  display:inline-flex;align-items:center;gap:6px;
  padding:4px 10px;border-radius:999px;font-size:11px;margin-top:10px;
  background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);
}
.dot{width:8px;height:8px;border-radius:50%;}
.dot.idle{background:#777;}
.dot.live{background:#3cffc2;box-shadow:0 0 6px #3cffc2;}

.card{
  background:radial-gradient(circle at top left,rgba(177,132,255,0.08),rgba(7,4,30,0.9));
  border-radius:18px;padding:16px;border:1px solid rgba(177,132,255,0.35);
  box-shadow:0 18px 40px rgba(0,0,0,0.6);
  display:flex;flex-direction:column;height:60vh;
}
#chatBox{
  flex:1;overflow-y:auto;padding-right:4px;
  display:flex;flex-direction:column;gap:10px;
}
.bubble{
  max-width:80%;padding:10px 14px;border-radius:14px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.08);
  font-size:14px;line-height:1.4;position:relative;word-break:break-word;
}
.me{
  align-self:flex-end;
  background:linear-gradient(135deg,#d68bff,#8b5dff);
  border:1px solid rgba(255,255,255,0.2);
  color:#fff;
}
.info{font-size:11px;color:var(--text-sub);margin-bottom:4px;}
.admin-del{
  position:absolute;top:-4px;right:-4px;font-size:10px;
  padding:3px 6px;border-radius:6px;border:none;
  background:#ff4b6a;color:#fff;cursor:pointer;
}
.input-wrap{display:flex;gap:10px;margin-top:12px;}
#chatInput{
  flex:1;padding:12px;border-radius:12px;
  background:rgba(5,3,20,0.9);
  border:1px solid rgba(255,255,255,0.08);
  color:#fff;font-size:14px;outline:none;
}
#sendBtn{
  flex-shrink:0;padding:12px 20px;border-radius:12px;border:none;
  background:linear-gradient(135deg,#d68bff,#8b5dff);
  color:#fff;font-weight:600;font-size:14px;cursor:pointer;
  box-shadow:0 10px 22px rgba(140,86,255,0.5);
}
.menu-btn{
  position:absolute;right:10px;top:14px;
  padding:6px 10px;border-radius:999px;
  background:rgba(9,9,40,0.7);
  border:1px solid rgba(177,132,255,0.4);
  cursor:pointer;color:#fff;font-size:18px;
}
.side-menu{
  position:fixed;top:0;right:-270px;width:260px;height:100%;
  background:radial-gradient(circle at top,#261654 0,#050314 60%);
  border-left:1px solid rgba(177,132,255,0.35);
  box-shadow:-18px 0 40px rgba(0,0,0,0.7);
  padding:20px 16px;transition:0.28s ease-out;z-index:999;
}
.side-menu.open{right:0;}
.side-menu h2{font-size:18px;color:var(--accent);margin:0 0 8px;}
.side-menu h3{font-size:12px;color:var(--text-sub);margin:18px 0 6px;}
.side-menu input{
  width:100%;padding:9px 10px;border-radius:10px;border:none;
  background:rgba(255,255,255,0.08);color:#fff;font-size:13px;margin-bottom:4px;
}
.side-menu button{
  width:100%;padding:10px;border:none;border-radius:10px;font-size:13px;
  background:linear-gradient(135deg,#d68bff,#8b5dff);color:#fff;font-weight:600;
  cursor:pointer;margin-top:8px;
}
.side-menu .sub{
  background:rgba(255,255,255,0.08);color:var(--text-sub);
  border:1px solid rgba(255,255,255,0.15);
}
.menu-close{
  position:absolute;right:14px;top:10px;background:rgba(255,255,255,0.12);
  padding:4px 8px;border-radius:8px;font-size:16px;cursor:pointer;color:#fff;
}
</style>
</head>
<body>
<div class="app">
<header>
  <div class="logo">ğŸ’¬ Eleview Chat <span style="font-size:11px;color:var(--text-sub);">LIVE</span></div>
  <div class="title">ì‹¤ì‹œê°„ ì±„íŒ…ë°©</div>
  <div class="subtitle">ë‹‰ë„¤ì„ ì„¤ì • í›„ ììœ ë¡­ê²Œ ëŒ€í™”í•´ë³´ì„¸ìš”!</div>
  <div class="status-chip"><div class="dot idle" id="statusDot"></div><span id="statusText">ëŒ€ê¸°</span></div>
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
</header>

<section class="card">
  <div id="chatBox"></div>
  <div class="input-wrap">
    <input id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button id="sendBtn" onclick="sendMessage()">ì „ì†¡</button>
  </div>
</section>
</div>

<!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
<div class="side-menu" id="sideMenu">
  <div class="menu-close" onclick="toggleMenu()">âœ•</div>
  <h2>ê³„ì • ì„¤ì •</h2>

  <h3>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>
  <input id="email" type="email" placeholder="ì´ë©”ì¼">
  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <button class="sub" onclick="signup()">íšŒì›ê°€ì…</button>

  <h3>ë‹‰ë„¤ì„</h3>
  <input id="nickname" type="text" placeholder="ë‹‰ë„¤ì„">
  <button onclick="saveNickname()">ì €ì¥</button>

  <h3>ê¸°íƒ€</h3>
  <button class="sub" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyApdyHj-1DiEsOG7XZ6zmDLIEwtLJZ70Js",
  authDomain:"elev-5374e.firebaseapp.com",
  databaseURL:"https://elev-5374e-default-rtdb.firebaseio.com",
  projectId:"elev-5374e",
  storageBucket:"elev-5374e.appspot.com",
  messagingSenderId:"265381396625",
  appId:"1:265381396625:web:5a3db379ef4a038ee43f30"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

let currentUser=null;
let nickname=localStorage.getItem("nickname")||"ìµëª…";
const adminEmails=["candle0627@gmail.com","testadmin@sample.com"];

function toggleMenu(){
  document.getElementById("sideMenu").classList.toggle("open");
}

// ì¸ì¦ ìƒíƒœ
auth.onAuthStateChanged(u=>{
  currentUser=u;
  const dot=document.getElementById("statusDot");
  const txt=document.getElementById("statusText");
  if(u){dot.classList.remove("idle");dot.classList.add("live");txt.textContent="ì˜¨ë¼ì¸";loadMessages();}
  else{dot.classList.remove("live");dot.classList.add("idle");txt.textContent="ì˜¤í”„ë¼ì¸";}
});

// ë¡œê·¸ì¸/íšŒì›ê°€ì…
function login(){
  const email=document.getElementById("email").value.trim();
  const pw=document.getElementById("password").value.trim();
  auth.signInWithEmailAndPassword(email,pw)
    .then(()=>alert("ë¡œê·¸ì¸ ì™„ë£Œ!")).catch(e=>alert(e.message));
}
function signup(){
  const email=document.getElementById("email").value.trim();
  const pw=document.getElementById("password").value.trim();
  auth.createUserWithEmailAndPassword(email,pw)
    .then(()=>alert("íšŒì›ê°€ì… ì™„ë£Œ!")).catch(e=>alert(e.message));
}
function logout(){auth.signOut().then(()=>alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ"));}

// ë‹‰ë„¤ì„
function saveNickname(){
  const n=document.getElementById("nickname").value.trim();
  if(!n)return alert("ë‹‰ë„¤ì„ ì…ë ¥!");
  nickname=n;localStorage.setItem("nickname",n);
  if(currentUser) db.ref("lokchat/users/"+currentUser.uid).set({email:currentUser.email,nick:n});
  alert("ë‹‰ë„¤ì„ ì €ì¥ ì™„ë£Œ");
}

// ë©”ì‹œì§€ ì „ì†¡
function sendMessage(){
  if(!currentUser)return alert("ë¡œê·¸ì¸ í•„ìš”!");
  const input=document.getElementById("chatInput");
  const text=input.value.trim();
  if(!text)return;
  db.ref("lokchat/messages").push({
    text,author:nickname,uid:currentUser.uid,email:currentUser.email,
    admin:adminEmails.includes(currentUser.email),
    createdAt:Date.now()
  });
  input.value="";
}

// ë©”ì‹œì§€ ë¡œë“œ
function loadMessages(){
  const box=document.getElementById("chatBox");
  const ref=db.ref("lokchat/messages");
  ref.off();

  ref.on("child_added",snap=>{
    const m=snap.val();
    const div=document.createElement("div");
    const date=new Date(m.createdAt);
    const time=date.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});
    const me=currentUser&&m.uid===currentUser.uid;
    div.className="bubble"+(me?" me":"");
    div.innerHTML=`<div class='info'>${m.author} Â· ${time}</div>${m.text}`;

    // ê´€ë¦¬ì ì‚­ì œë²„íŠ¼
    if(currentUser && adminEmails.includes(currentUser.email)){
      const del=document.createElement("button");
      del.className="admin-del";
      del.textContent="ì‚­ì œ";
      del.onclick=()=>db.ref("lokchat/messages/"+snap.key).remove();
      div.appendChild(del);
    }

    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
  });

  ref.on("child_removed",snap=>{
    const nodes=box.querySelectorAll(".bubble");
    nodes.forEach(n=>{
      if(n.textContent.includes(snap.val()?.text)){
        n.remove();
      }
    });
  });
}

document.getElementById("chatInput").addEventListener("keyup",e=>{
  if(e.key==="Enter")sendMessage();
});
</script>
</body>
</html>