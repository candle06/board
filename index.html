<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Eleview Board</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
html, body {
  min-height: 100%;
  margin: 0;
  padding: 0;
  font-family: "Inter", "Noto Sans KR", sans-serif;
  background: #000;
  color: #fff;
  overflow-x: hidden;
}

/* ========================
      íŒŒí‹°í´ ë°°ê²½
========================= */
#particle-bg {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}

/* ========================
      ì „ì²´ ë ˆì´ì•„ì›ƒ
========================= */
.app {
  position: relative;
  z-index: 2;
  max-width: 480px;
  margin: 0 auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  min-height: 100vh;
}

header {
  text-align: center;
  margin-top: 4vh;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}

.logo {
  font-size: 20px;
  font-weight: 700;
  background: rgba(255,255,255,0.07);
  padding: 10px 16px;
  border-radius: 14px;
  box-shadow: 0 0 20px rgba(155,92,255,0.4);
}

#menuBtn {
  position: absolute;
  right: 10px;
  font-size: 24px;
  background: none;
  border: none;
  color: #fff;
  cursor: pointer;
}

/* ========================
      ìƒë‹¨ ë©”ë‰´ íŒ¨ë„
========================= */
#menuPanel {
  display: none;
  position: absolute;
  top: 60px;
  right: 10px;
  background: rgba(0,0,0,0.85);
  padding: 10px;
  border-radius: 12px;
  min-width: 160px;
  flex-direction: column;
  gap: 8px;
}

#menuPanel button,
#menuPanel a {
  border: none;
  padding: 6px 0;
  background: none;
  color: #fff;
  font-size: 14px;
  border-radius: 10px;
  cursor: pointer;
  text-align: center;
  display: block;
  text-decoration: none;
}

/* ========================
      ë²„íŠ¼ ë””ìì¸
========================= */
.btn-main {
  background: linear-gradient(135deg, #9b5cff, #682aff);
  border: none;
  color: #fff;
  padding: 13px;
  border-radius: 16px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 8px 22px rgba(155,92,255,0.45);
  transition: 0.15s;
}
.btn-main:hover {
  transform: translateY(-2px);
}

.btn-sub {
  border: none;
  padding: 8px 12px;
  font-size: 13px;
  border-radius: 10px;
  background: rgba(255,255,255,0.1);
  color: #fff;
  cursor: pointer;
}
.btn-sub:hover {
  background: rgba(255,255,255,0.2);
}

.btn-danger {
  background: rgba(255,60,60,0.2);
  border: 1px solid rgba(255,80,80,0.5);
}
.btn-danger:hover {
  background: rgba(255,60,60,0.35);
}

/* ========================
       ì¹´ë“œ ë””ìì¸
========================= */
.card {
  background: rgba(255,255,255,0.07);
  padding: 14px;
  border-radius: 14px;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.card-title {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 4px;
}

.card-meta {
  font-size: 12px;
  color: #bbb;
  margin-bottom: 10px;
}

.card-snippet {
  font-size: 14px;
  color: #eee;
}
/* ============================
   ğŸ“± ë¡œê·¸ì¸/ê¸€ì“°ê¸° ëª¨ë‹¬ ì‚¬ì´ì¦ˆ ìµœì í™”
============================ */
.modal-box {
  padding: 14px !important;
  max-width: 360px !important;
  border-radius: 14px !important;
}

#loginModal .modal-box,
#postModal .modal-box,
#profileModal .modal-box,
#viewModal .modal-box {
  padding: 16px !important;
}

.input {
  padding: 9px 12px !important;
  font-size: 14px !important;
}

textarea.input {
  min-height: 80px !important;
  max-height: 120px !important;
  line-height: 1.35 !important;
}


/* ============================
      ëª¨ë°”ì¼ ì „ìš© ë³´ì •
============================ */
@media (max-width: 480px) {

  .modal-box {
    width: 92% !important;
    max-width: 330px !important;
    padding: 12px !important;
  }

  #loginModal .modal-box,
  #postModal .modal-box,
  #profileModal .modal-box {
    padding: 12px !important;
  }

  .input {
    padding: 8px 10px !important;
    font-size: 13px !important;
  }

  textarea.input {
    min-height: 70px !important;
    max-height: 110px !important;
  }

  .btn-main {
    padding: 11px !important;
    font-size: 14px !important;
    border-radius: 12px !important;
  }

  .btn-sub {
    padding: 8px !important;
    font-size: 13px !important;
  }
}
/* ========================
        ëª¨ë‹¬ ê³µí†µ
========================= */
.modal-backdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(6px);
  justify-content: center;
  align-items: center;
  z-index: 20;
}

.modal-box {
  width: 92%;
  max-width: 380px;
  background: rgba(20,20,30,0.92);
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(155,92,255,0.4);
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.input {
  width: 93%;
  padding: 11px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(155,92,255,0.5);
  border-radius: 10px;
  color: #fff;
  outline: none;
}

textarea.input {
  resize: none;
  min-height: 140px;
}

/* ========================
       ëª¨ë°”ì¼ ëŒ€ì‘
========================= */
@media (max-width: 480px) {
  .app { padding: 12px; }
  .logo { font-size: 17px; padding: 8px 12px; }
  .btn-main { font-size: 14px; padding: 12px; border-radius: 14px; }
  .card { padding: 12px; }
  .modal-box { width: 94%; padding: 14px; }
  textarea.input { min-height: 110px; }
}
</style>
</head>
<body>

<canvas id="particle-bg"></canvas>

<div class="app">

  <!-- =============================
          í—¤ë” / ë©”ë‰´ë²„íŠ¼
  ============================== -->
  <header>
    <div class="logo">Eleview Board</div>
    <button id="menuBtn">â˜°</button>

    <!-- ë©”ë‰´ íŒ¨ë„ -->
    <div id="menuPanel">
      <a href="https://candle06.github.io/Eleview/" style="border:2px solid #9b5cff;color:#9b5cff;">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
      <button id="profileBtn" style="border:2px solid #77ddff;color:#77ddff;">ğŸ‘¤ í”„ë¡œí•„ ì„¤ì •</button>
      <button id="loginMenuBtn" style="border:2px solid #4da3ff;color:#4da3ff;">ğŸ” ë¡œê·¸ì¸</button>
    </div>
  </header>

  <div style="text-align:center;font-size:13px;color:#aaa;">
    Eleview ê³µì‹ ê²Œì‹œíŒ  
    <div style="font-size:11px;color:#777;">ë‹‰ë„¤ì„, ëŒ“ê¸€, ì‚¬ì§„ ì—…ë¡œë“œ ì§€ì›</div>
  </div>

  <!-- ìƒˆ ê¸€ ì‘ì„± ë²„íŠ¼ -->
  <button id="newPostBtn" class="btn-main">âœï¸ ìƒˆ ê¸€ ì‘ì„±</button>

  <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
  <div id="postList"></div>

  <div style="text-align:center;color:#777;font-size:11px;margin-top:20px;">
    Â© 2025 Eleview Board
  </div>

</div>


<!-- =======================================================
                      ë¡œê·¸ì¸ ëª¨ë‹¬
======================================================= -->
<div id="loginModal" class="modal-backdrop">
  <div class="modal-box">
    <h3>ğŸ” ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>

    <input type="email" id="loginEmail" class="input" placeholder="ì´ë©”ì¼ ì…ë ¥">
    <input type="password" id="loginPw" class="input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">

    <button id="loginDoBtn" class="btn-main">ë¡œê·¸ì¸</button>
    <button id="signupDoBtn" class="btn-main" style="background:#4da3ff;">íšŒì›ê°€ì…</button>

    <button id="closeLoginModal" class="btn-sub">ë‹«ê¸°</button>
  </div>
</div>


<!-- =======================================================
                     ê¸€ì“°ê¸° ëª¨ë‹¬
======================================================= -->
<div id="postModal" class="modal-backdrop">
  <div class="modal-box">
    <h3>âœï¸ ìƒˆ ê¸€ ì‘ì„±</h3>

    <input id="postTitle" class="input" placeholder="ì œëª©">
    <textarea id="postContent" class="input" placeholder="ë‚´ìš©"></textarea>

    <input id="imageUpload" type="file" accept="image/*" class="input">

    <button id="savePostBtn" class="btn-main">ì €ì¥</button>
    <button id="cancelPostBtn" class="btn-sub">ì·¨ì†Œ</button>
  </div>
</div>


<!-- =======================================================
                     ê¸€ ë³´ê¸° ëª¨ë‹¬
======================================================= -->
<div id="viewModal" class="modal-backdrop">
  <div class="modal-box">
    <h3 id="viewContentTitle"></h3>
    <div id="viewContentMeta" style="font-size:12px;color:#bbb;"></div>

    <div id="viewContentBody" style="white-space:pre-line;margin-top:10px;font-size:14px;"></div>

    <h3 style="margin-top:15px;font-size:15px;">ğŸ’¬ ëŒ“ê¸€</h3>
    <div id="commentList" style="max-height:200px;overflow-y:auto;"></div>

    <textarea id="commentInput" class="input" placeholder="ëŒ“ê¸€ ì…ë ¥"></textarea>
    <button id="sendCommentBtn" class="btn-main">ëŒ“ê¸€ ì‘ì„±</button>

    <button id="deletePostBtn" class="btn-danger btn-sub" style="margin-top:10px;display:none;">ê²Œì‹œê¸€ ì‚­ì œ (ê´€ë¦¬ì)</button>
    <button id="closeViewModal" class="btn-sub">ë‹«ê¸°</button>
  </div>
</div>


<!-- =======================================================
                     í”„ë¡œí•„ ì„¤ì • ëª¨ë‹¬
======================================================= -->
<div id="profileModal" class="modal-backdrop">
  <div class="modal-box">
    <h3>ğŸ‘¤ ë‹‰ë„¤ì„ ì„¤ì •</h3>

    <input id="nicknameInput" class="input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">

    <button id="saveNicknameBtn" class="btn-main">ì €ì¥</button>
    <button id="closeProfileModal" class="btn-sub">ë‹«ê¸°</button>
  </div>
</div>
<!-- ================================
       Firebase SDK ë¶ˆëŸ¬ì˜¤ê¸°
================================ -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
/* ======================================
          ğŸ”¥ Firebase ì´ˆê¸°í™”
====================================== */
const firebaseConfig = {
  apiKey: "AIzaSyApdyHj-1DiEsOG7XZ6zmDLIEwtLJZ70Js",
  authDomain: "elev-5374e.firebaseapp.com",
  databaseURL: "https://elev-5374e-default-rtdb.firebaseio.com",
  projectId: "elev-5374e",
  storageBucket: "elev-5374e.firebasestorage.app",
  messagingSenderId: "265381396625",
  appId: "1:265381396625:web:5a3db379ef4a038ee43f30"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

const ADMIN_EMAIL = "candle0627@gmail.com";   // ê´€ë¦¬ì ì´ë©”ì¼

let currentUser = null;
let currentPostKey = null;

/* HTML ID ê°€ì ¸ì˜¤ê¸° */
const menuBtn = document.getElementById("menuBtn");
const menuPanel = document.getElementById("menuPanel");
const loginMenuBtn = document.getElementById("loginMenuBtn");
const profileBtn = document.getElementById("profileBtn");

const loginModal = document.getElementById("loginModal");
const loginEmail = document.getElementById("loginEmail");
const loginPw = document.getElementById("loginPw");
const loginDoBtn = document.getElementById("loginDoBtn");
const signupDoBtn = document.getElementById("signupDoBtn");
const closeLoginModal = document.getElementById("closeLoginModal");

const postModal = document.getElementById("postModal");
const postTitle = document.getElementById("postTitle");
const postContent = document.getElementById("postContent");
const imageUpload = document.getElementById("imageUpload");
const savePostBtn = document.getElementById("savePostBtn");
const cancelPostBtn = document.getElementById("cancelPostBtn");

const newPostBtn = document.getElementById("newPostBtn");
const postList = document.getElementById("postList");

const viewModal = document.getElementById("viewModal");
const viewContentTitle = document.getElementById("viewContentTitle");
const viewContentMeta = document.getElementById("viewContentMeta");
const viewContentBody = document.getElementById("viewContentBody");
const closeViewModal = document.getElementById("closeViewModal");
const deletePostBtn = document.getElementById("deletePostBtn");

const commentList = document.getElementById("commentList");
const commentInput = document.getElementById("commentInput");
const sendCommentBtn = document.getElementById("sendCommentBtn");

const profileModal = document.getElementById("profileModal");
const nicknameInput = document.getElementById("nicknameInput");
const saveNicknameBtn = document.getElementById("saveNicknameBtn");
const closeProfileModal = document.getElementById("closeProfileModal");

/* ======================================
         ğŸ§© ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°
====================================== */
menuBtn.onclick = () => {
  menuPanel.style.display =
    menuPanel.style.display === "flex" ? "none" : "flex";
};

/* ë¹ˆ ê³µê°„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ ë‹«ê¸° */
window.addEventListener("click", (e) => {
  document.querySelectorAll(".modal-backdrop").forEach(modal => {
    if (e.target === modal) modal.style.display = "none";
  });
});

/* ================================
         HTML ì•ˆì „ escape ì²˜ë¦¬
================================ */
function escapeHtml(text) {
  if (!text) return "";
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

/* ======================================
      ğŸ”‘ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ â†’ ë¡œê·¸ì¸ ëª¨ë‹¬
====================================== */
loginMenuBtn.onclick = () => {
  if (currentUser) {
    auth.signOut();
  } else {
    loginModal.style.display = "flex";
  }
};

closeLoginModal.onclick = () => {
  loginModal.style.display = "none";
};

/* ======================================
              ë¡œê·¸ì¸ ì‹¤í–‰
====================================== */
loginDoBtn.onclick = () => {
  const email = loginEmail.value.trim();
  const pw = loginPw.value.trim();

  auth.signInWithEmailAndPassword(email, pw)
    .then(() => {
      loginModal.style.display = "none";
    })
    .catch(err => alert(err.message));
};

/* ======================================
              íšŒì›ê°€ì… ì‹¤í–‰
====================================== */
signupDoBtn.onclick = () => {
  const email = loginEmail.value.trim();
  const pw = loginPw.value.trim();

  auth.createUserWithEmailAndPassword(email, pw)
    .then(() => {
      loginModal.style.display = "none";
    })
    .catch(err => alert(err.message));
};
/* ======================================
     âœï¸ ìƒˆ ê¸€ ì‘ì„± ë²„íŠ¼ â†’ ê¸€ì“°ê¸° ëª¨ë‹¬ ì—´ê¸°
====================================== */
newPostBtn.onclick = () => {
  if (!currentUser) {
    loginModal.style.display = "flex";
    return;
  }

  // ëª¨ë“  ëª¨ë‹¬ ê°•ì œ ë‹«ê¸° (ì…ë ¥ì°½ í´ë¦­ ì•ˆë˜ëŠ” ë¬¸ì œ í•´ê²°)
  

  postTitle.value = "";
  postContent.value = "";
  imageUpload.value = "";

  postModal.style.display = "flex";
};

cancelPostBtn.onclick = () => {
  postModal.style.display = "none";
};


/* ======================================
        ğŸ“ ê¸€ ì €ì¥ + ì´ë¯¸ì§€ ì—…ë¡œë“œ
====================================== */
savePostBtn.onclick = async () => {
  if (!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

  const title = postTitle.value.trim();
  const content = postContent.value.trim();
  if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");

  // ë‹‰ë„¤ì„ ê°€ì ¸ì˜¤ê¸°
  const snap = await db.ref("users/" + currentUser.uid + "/nickname").once("value");
  const nickname = snap.val() || currentUser.email;

  // ì´ë¯¸ì§€ ì—…ë¡œë“œ
  let imageUrl = "";
  const file = imageUpload.files[0];

  if (file) {
    const storageRef = storage.ref();
    const imgRef = storageRef.child("board_images/" + Date.now() + "_" + file.name);
    const snapshot = await imgRef.put(file);
    imageUrl = await imgRef.getDownloadURL();
  }

  const now = new Date();
  const dateString =
    now.getFullYear() + "-" +
    String(now.getMonth() + 1).padStart(2, "0") + "-" +
    String(now.getDate()).padStart(2, "0") + " " +
    String(now.getHours()).padStart(2, "0") + ":" +
    String(now.getMinutes()).padStart(2, "0");

  // *** í•µì‹¬ ìˆ˜ì •: await ì¶”ê°€ ***
  await db.ref("board/posts").push({
    title,
    content,
    imageUrl,
    authorEmail: currentUser.email,
    authorNickname: nickname,
    createdAt: Date.now(),
    createdAtString: dateString
  });

  postModal.style.display = "none";
  postTitle.value = "";
  postContent.value = "";
  imageUpload.value = "";
};

/* ======================================
            ğŸ“„ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
====================================== */
function renderPosts(snap) {
  // ğŸ‘‡ ë¡œê·¸ì¸ ì—¬ë¶€ ìƒê´€ì—†ì´ ê²Œì‹œê¸€ì€ í•­ìƒ ë³´ì—¬ì¤Œ
  if (!snap.exists()) {
    postList.innerHTML = `<div style="text-align:center;color:#aaa;">ê²Œì‹œê¸€ ì—†ìŒ</div>`;
    return;
  }

  let arr = [];
  snap.forEach(v => arr.push({ key: v.key, ...v.val() }));
  arr.sort((a, b) => b.createdAt - a.createdAt);

  postList.innerHTML = arr.map(v => `
    <div class="card" data-key="${v.key}">
      <div class="card-title">${escapeHtml(v.title)}</div>
      <div class="card-meta">${escapeHtml(v.authorNickname)} Â· ${v.createdAtString}</div>
      <div class="card-snippet">${escapeHtml(v.content.slice(0, 70))}...</div>
      <div style="text-align:right;margin-top:10px;">
        <button class="btn-sub btn-view">ë³´ê¸°</button>
      </div>
    </div>
  `).join("");
}


/* ======================================
       ğŸ‘ ê²Œì‹œê¸€ "ë³´ê¸°" ë²„íŠ¼ ì²˜ë¦¬
====================================== */
postList.onclick = (e) => {
  if (!e.target.classList.contains("btn-view")) return;

  const key = e.target.closest(".card").dataset.key;
  openPost(key);
};


/* ======================================
           ğŸ“– ê²Œì‹œê¸€ ë³´ê¸° í•¨ìˆ˜
====================================== */
function openPost(key) {
  currentPostKey = key;

  db.ref("board/posts/" + key).once("value", snap => {
    if (!snap.exists()) return;

    const v = snap.val();

    viewContentTitle.textContent = v.title;
    viewContentMeta.textContent = `${v.authorNickname} Â· ${v.createdAtString}`;

    let img = v.imageUrl
      ? `<img src="${v.imageUrl}" style="width:100%;border-radius:12px;margin-bottom:10px;">`
      : "";

    viewContentBody.innerHTML = img + escapeHtml(v.content);

    // ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥
    deletePostBtn.style.display = (currentUser?.email === ADMIN_EMAIL) ? "block" : "none";

    viewModal.style.display = "flex";
    loadComments(key);
  });
}

closeViewModal.onclick = () => {
  viewModal.style.display = "none";
};


/* ======================================
            âŒ ê²Œì‹œê¸€ ì‚­ì œ
====================================== */
deletePostBtn.onclick = () => {
  if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  db.ref("board/posts/" + currentPostKey).remove();
  viewModal.style.display = "none";
};
/* ======================================
           ğŸ’¬ ëŒ“ê¸€ ì‘ì„±
====================================== */
sendCommentBtn.onclick = () => {
  if (!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");

  const text = commentInput.value.trim();
  if (!text) return;

  db.ref("users/" + currentUser.uid + "/nickname")
    .once("value", snap => {
      let nick = snap.val() || currentUser.email;

      db.ref("board/comments/" + currentPostKey).push({
        text,
        author: nick,
        time: Date.now()
      });

      commentInput.value = "";
    });
};


/* ======================================
           ğŸ’¬ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
====================================== */
function loadComments(postKey) {
  db.ref("board/comments/" + postKey).on("value", snap => {
    if (!snap.exists()) {
      commentList.innerHTML =
        `<div style="color:#aaa;font-size:12px;">ëŒ“ê¸€ ì—†ìŒ</div>`;
      return;
    }

    let html = "";
    snap.forEach(item => {
      const v = item.val();
      html += `
        <div style="padding:8px;margin-bottom:6px;border-radius:10px;background:rgba(255,255,255,0.06);">
          <div style="font-size:12px;color:#9b5cff;font-weight:600;">
            ${escapeHtml(v.author)}
          </div>
          <div style="font-size:14px;margin-top:4px;">
            ${escapeHtml(v.text)}
          </div>
        </div>
      `;
    });

    commentList.innerHTML = html;
  });
}


/* ======================================
             ğŸ‘¤ í”„ë¡œí•„ (ë‹‰ë„¤ì„)
====================================== */
profileBtn.onclick = () => {
  if (!currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");

  db.ref("users/" + currentUser.uid + "/nickname").once("value", snap => {
    nicknameInput.value = snap.val() || "";
    profileModal.style.display = "flex";
  });
};

closeProfileModal.onclick = () => {
  profileModal.style.display = "none";
};

saveNicknameBtn.onclick = () => {
  const nick = nicknameInput.value.trim();
  if (!nick) return;

  db.ref("users/" + currentUser.uid + "/nickname").set(nick);
  alert("ë‹‰ë„¤ì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
  profileModal.style.display = "none";
};


/* ======================================
        ğŸ”¥ ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
====================================== */
auth.onAuthStateChanged(user => {
  currentUser = user;

  if (user) {
    loginMenuBtn.textContent = "ğŸšª ë¡œê·¸ì•„ì›ƒ";
    loginMenuBtn.style.color = "#ff4444";
    loginMenuBtn.style.borderColor = "#ff4444";
    loginMenuBtn.onclick = () => auth.signOut();
  } else {
    loginMenuBtn.textContent = "ğŸ” ë¡œê·¸ì¸";
    loginMenuBtn.style.color = "#4da3ff";
    loginMenuBtn.style.borderColor = "#4da3ff";
    loginMenuBtn.onclick = () => loginModal.style.display = "flex";
  }

  // ì‹¤ì‹œê°„ ê²Œì‹œê¸€ ë°˜ì˜
  db.ref("board/posts").on("value", renderPosts);
});


/* ======================================
          âœ¨ íŒŒí‹°í´ ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜
====================================== */
const canvas = document.getElementById("particle-bg");
const ctx = canvas.getContext("2d");
let w, h, particles = [];

function resizeCanvas() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function initParticles() {
  particles = [];
  for (let i = 0; i < 70; i++) {
    particles.push({
      x: Math.random() * w,
      y: Math.random() * h,
      vx: (Math.random() - 0.5) * 0.4,
      vy: (Math.random() - 0.5) * 0.4,
      size: Math.random() * 2 + 1
    });
  }
}
initParticles();

function drawParticles() {
  ctx.clearRect(0, 0, w, h);

  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;

    if (p.x < 0) p.x = w;
    if (p.x > w) p.x = 0;
    if (p.y < 0) p.y = h;
    if (p.y > h) p.y = 0;

    const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 15);
    g.addColorStop(0, "#9b5cff");
    g.addColorStop(1, "transparent");

    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fill();
  });

  requestAnimationFrame(drawParticles);
}

drawParticles();

</script>
</body>
</html>